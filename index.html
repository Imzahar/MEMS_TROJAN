<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEMS TROJAN - Продвинутый создатель мемов</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #00d4ff;
            --primary-dark: #0099cc;
            --secondary: #ff3366;
            --dark: #0a0e17;
            --dark-light: #1a2238;
            --light: #f5f7fa;
            --gray: #8a93a7;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--dark);
            color: var(--light);
            line-height: 1.6;
        }
        
        h1, h2, h3, h4 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header */
        header {
            background-color: rgba(10, 14, 23, 0.95);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(0, 212, 255, 0.2);
            padding: 15px 0;
        }
        
        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
            display: none;
        }
        
        .logo-icon.has-custom-logo img {
            display: block;
        }
        
        .logo-icon.has-custom-logo::after {
            display: none;
        }
        
        .logo-icon::after {
            content: "";
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: var(--dark);
            border-radius: 50%;
            transform: rotate(45deg);
        }
        
        .logo-text {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
        }
        
        .logo-text span {
            color: var(--primary);
        }
        
        .nav-links {
            display: flex;
            gap: 30px;
        }
        
        .nav-links a {
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
            transition: color 0.3s;
            position: relative;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            background: var(--primary);
            bottom: -5px;
            left: 0;
            transition: width 0.3s;
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        /* Hero Section */
        .hero {
            padding: 80px 0;
            background: linear-gradient(135deg, rgba(10, 14, 23, 0.9) 0%, rgba(26, 34, 56, 0.9) 100%), 
                        radial-gradient(circle at 20% 50%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 51, 102, 0.1) 0%, transparent 50%);
        }
        
        .hero-content {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1.2;
        }
        
        .hero p {
            font-size: 20px;
            color: var(--gray);
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .cta-button {
            display: inline-block;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px 40px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 18px;
            transition: all 0.3s;
            box-shadow: 0 10px 20px rgba(0, 212, 255, 0.3);
            border: none;
            cursor: pointer;
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 25px rgba(0, 212, 255, 0.4);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 40px;
            border-bottom: 2px solid var(--dark-light);
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 15px 30px;
            background: transparent;
            border: none;
            color: var(--gray);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab-button:hover {
            color: var(--primary);
        }
        
        .tab-button.active {
            color: var(--primary);
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Main Content */
        .main-content {
            padding: 80px 0;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 50px;
            position: relative;
        }
        
        .section-title h2 {
            font-size: 36px;
            display: inline-block;
            position: relative;
            z-index: 1;
        }
        
        .section-title h2::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 10px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            bottom: 5px;
            left: 0;
            z-index: -1;
            opacity: 0.5;
        }
        
        /* Meme Templates */
        .meme-templates {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 60px;
        }
        
        .meme-card {
            background-color: var(--dark-light);
            border-radius: 15px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .meme-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            border-color: rgba(0, 212, 255, 0.3);
        }
        
        .meme-image {
            height: 200px;
            background-color: #2a354f;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        
        .meme-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        
        .meme-card:hover .meme-image img {
            transform: scale(1.05);
        }
        
        .meme-info {
            padding: 20px;
        }
        
        .meme-info h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .meme-info p {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 40px;
        }
        
        .use-template {
            background-color: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-size: 16px;
        }
        
        .use-template:hover {
            background-color: var(--primary);
            color: var(--dark);
        }
        
        /* Meme Editor */
        .meme-editor {
            background-color: var(--dark-light);
            border-radius: 15px;
            padding: 40px;
            margin-top: 40px;
            display: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.1);
        }
        
        .editor-active {
            display: block;
        }
        
        .editor-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .canvas-container {
            flex: 1;
            min-width: 300px;
            background-color: var(--dark);
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        .canvas-wrapper {
            position: relative;
            max-width: 100%;
        }
        
        #memeCanvas {
            max-width: 100%;
            background-color: white;
            border-radius: 5px;
            display: block;
        }
        
        .editor-controls {
            flex: 1;
            min-width: 300px;
        }
        
        .editor-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .editor-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .editor-tab:hover {
            color: var(--primary);
        }
        
        .editor-tab.active {
            color: var(--primary);
        }
        
        .editor-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
        }
        
        .editor-panel {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .editor-panel.active {
            display: block;
        }
        
        .control-group {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .control-group h4 {
            margin-bottom: 15px;
            color: var(--primary);
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-group h4 i {
            font-size: 20px;
        }
        
        .text-input {
            width: 100%;
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 16px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
        }
        
        .range-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .range-container label {
            min-width: 120px;
            color: var(--gray);
        }
        
        input[type="range"] {
            flex: 1;
            height: 5px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            outline: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
        }
        
        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.active {
            border-color: white;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .editor-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .editor-btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 120px;
        }
        
        .primary-btn {
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            color: white;
            flex: 2;
        }
        
        .secondary-btn {
            background-color: transparent;
            color: var(--gray);
            border: 1px solid var(--gray);
            flex: 1;
        }
        
        .tertiary-btn {
            background-color: transparent;
            color: var(--secondary);
            border: 1px solid var(--secondary);
            flex: 1;
        }
        
        .primary-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.4);
        }
        
        .secondary-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .tertiary-btn:hover {
            background-color: rgba(255, 51, 102, 0.1);
        }
        
        /* Font selector */
        .font-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .font-option {
            padding: 10px;
            text-align: center;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }
        
        .font-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .font-option.active {
            border-color: var(--primary);
            background: rgba(0, 212, 255, 0.1);
        }
        
        /* Advanced features */
        .advanced-controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .feature-btn {
            padding: 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        
        .feature-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .feature-btn i {
            font-size: 20px;
        }
        
        /* Stickers panel */
        .stickers-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        
        .sticker-item {
            width: 60px;
            height: 60px;
            cursor: pointer;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .sticker-item:hover {
            transform: scale(1.1);
        }
        
        .sticker-item img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        /* Watermark settings */
        .watermark-settings {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 212, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }
        
        /* Preview section */
        .preview-section {
            display: none;
            margin-top: 20px;
            text-align: center;
        }
        
        .preview-container {
            display: inline-block;
            position: relative;
            margin: 20px 0;
        }
        
        #previewCanvas {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        /* Branding customization */
        .branding-settings {
            background: rgba(255, 51, 102, 0.05);
            border: 1px solid rgba(255, 51, 102, 0.2);
        }
        
        .brand-color-picker {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .brand-color {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .brand-color.active {
            border-color: white;
        }
        
        /* Footer */
        footer {
            background-color: var(--dark-light);
            padding: 40px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 40px;
        }
        
        .footer-logo {
            flex: 1;
            min-width: 250px;
        }
        
        .footer-logo .logo-text {
            font-size: 24px;
            margin-bottom: 15px;
            display: block;
        }
        
        .footer-logo p {
            color: var(--gray);
            max-width: 300px;
        }
        
        .footer-links {
            flex: 1;
            min-width: 200px;
        }
        
        .footer-links h4 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .footer-links ul {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: var(--gray);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: var(--primary);
        }
        
        .copyright {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--gray);
            font-size: 14px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background-color: var(--dark-light);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 100%;
            border: 1px solid var(--primary);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            color: var(--primary);
            font-size: 24px;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: var(--secondary);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .meme-templates {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 20px;
            }
            
            .nav-links {
                gap: 20px;
            }
            
            .hero h1 {
                font-size: 36px;
            }
            
            .hero p {
                font-size: 18px;
            }
            
            .editor-container {
                flex-direction: column;
            }
            
            .section-title h2 {
                font-size: 28px;
            }
            
            .advanced-controls {
                grid-template-columns: 1fr;
            }
            
            .editor-buttons {
                flex-direction: column;
            }
            
            .editor-btn {
                width: 100%;
            }
        }
        
        @media (max-width: 576px) {
            .meme-templates {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab-button {
                width: 100%;
                text-align: center;
            }
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--primary);
            font-size: 12px;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Loading animation */
        .loader {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            z-index: 10;
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--primary);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            display: none;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 40px;
        }
        
        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .page-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--primary);
        }
        
        .page-btn.active {
            background: var(--primary);
            color: var(--dark);
            border-color: var(--primary);
        }
        
        /* Template categories */
        .template-categories {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .category-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--gray);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .category-btn:hover {
            background: rgba(0, 212, 255, 0.1);
            color: var(--primary);
        }
        
        .category-btn.active {
            background: var(--primary);
            color: var(--dark);
            border-color: var(--primary);
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <div class="logo" id="logoContainer">
                <div class="logo-icon" id="logoIcon">
                    <img id="customLogo" alt="Логотип">
                </div>
                <div class="logo-text" id="logoText">MEMS <span>TROJAN</span></div>
            </div>
            <nav class="nav-links">
                <a href="#templates">Шаблоны</a>
                <a href="#editor">Редактор</a>
                <a href="#create">Создать мем</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container hero-content">
            <h1>Продвинутый создатель мемов</h1>
            <p>MEMS TROJAN - самый мощный онлайн-инструмент для создания мемов с искусственным интеллектом и расширенными функциями редактирования.</p>
            <button class="cta-button" id="startCreating">Начать создавать <i class="fas fa-arrow-right"></i></button>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container main-content">
        <!-- Tabs for meme sections -->
        <div class="tabs" id="memeTabs">
            <button class="tab-button active" data-tab="popular">Популярные мемы (25+)</button>
            <button class="tab-button" data-tab="recent">Последние добавленные</button>
            <button class="tab-button" data-tab="ai">AI-мемы</button>
            <button class="tab-button" data-tab="viral">Вирусные шаблоны</button>
            <button class="tab-button" data-tab="classic">Классика</button>
        </div>
        
        <!-- Popular Memes Tab -->
        <div class="tab-content active" id="popularTab">
            <div class="template-categories" id="popularCategories">
                <button class="category-btn active" data-category="all">Все</button>
                <button class="category-btn" data-category="animals">Животные</button>
                <button class="category-btn" data-category="movies">Фильмы</button>
                <button class="category-btn" data-category="games">Игры</button>
                <button class="category-btn" data-category="celebrities">Знаменитости</button>
                <button class="category-btn" data-category="reactions">Реакции</button>
            </div>
            
            <div class="meme-templates" id="popularTemplates">
                <!-- Templates will be loaded here by JavaScript -->
            </div>
            
            <div class="pagination" id="popularPagination">
                <!-- Pagination will be generated by JavaScript -->
            </div>
        </div>
        
        <!-- Recent Memes Tab -->
        <div class="tab-content" id="recentTab">
            <div class="meme-templates" id="recentTemplates">
                <!-- Recent templates will be loaded here -->
            </div>
        </div>
        
        <!-- AI Memes Tab -->
        <div class="tab-content" id="aiTab">
            <div style="text-align: center; padding: 40px;">
                <i class="fas fa-robot" style="font-size: 60px; color: var(--primary); margin-bottom: 20px;"></i>
                <h3 style="color: var(--primary); margin-bottom: 15px;">Генератор AI-мемов</h3>
                <p style="color: var(--gray); margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto;">
                    Создавайте уникальные мемы с помощью искусственного интеллекта. Просто опишите идею, и AI создаст мем для вас!
                </p>
                <div style="max-width: 500px; margin: 0 auto;">
                    <input type="text" class="text-input" id="aiPrompt" placeholder="Опишите идею для мема...">
                    <button class="cta-button" id="generateAiMeme" style="margin-top: 20px; width: 100%;">
                        <i class="fas fa-magic"></i> Сгенерировать AI-мем
                    </button>
                </div>
                <div class="meme-templates" id="aiTemplates" style="margin-top: 40px;">
                    <!-- AI generated memes will appear here -->
                </div>
            </div>
        </div>
        
        <!-- Meme Editor -->
        <section id="editor">
            <div class="section-title">
                <h2>Продвинутый редактор мемов</h2>
            </div>
            
            <div class="meme-editor" id="memeEditor">
                <div class="editor-container">
                    <div class="canvas-container">
                        <div class="loader" id="canvasLoader"></div>
                        <div class="canvas-wrapper">
                            <canvas id="memeCanvas" width="800" height="600"></canvas>
                        </div>
                        <div class="preview-section" id="previewSection">
                            <div class="preview-container">
                                <canvas id="previewCanvas" width="300" height="225"></canvas>
                            </div>
                            <p style="color: var(--gray); margin-top: 10px;">Предпросмотр для социальных сетей</p>
                        </div>
                    </div>
                    
                    <div class="editor-controls">
                        <div class="editor-tabs" id="editorTabs">
                            <button class="editor-tab active" data-panel="text">Текст</button>
                            <button class="editor-tab" data-panel="effects">Эффекты</button>
                            <button class="editor-tab" data-panel="stickers">Стикеры</button>
                            <button class="editor-tab" data-panel="branding">Брендинг</button>
                            <button class="editor-tab" data-panel="advanced">Дополнительно</button>
                        </div>
                        
                        <!-- Text Panel -->
                        <div class="editor-panel active" id="textPanel">
                            <div class="control-group">
                                <h4><i class="fas fa-text-height"></i> Верхний текст</h4>
                                <input type="text" class="text-input" id="topText" placeholder="Введите верхний текст...">
                                <div class="range-container">
                                    <label>Размер:</label>
                                    <input type="range" id="topFontSize" min="10" max="100" value="40">
                                    <span id="topFontSizeValue">40</span>
                                </div>
                                <div class="range-container">
                                    <label>Позиция Y:</label>
                                    <input type="range" id="topYPosition" min="10" max="300" value="50">
                                    <span id="topYValue">50</span>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h4><i class="fas fa-text-height"></i> Нижний текст</h4>
                                <input type="text" class="text-input" id="bottomText" placeholder="Введите нижний текст...">
                                <div class="range-container">
                                    <label>Размер:</label>
                                    <input type="range" id="bottomFontSize" min="10" max="100" value="40">
                                    <span id="bottomFontSizeValue">40</span>
                                </div>
                                <div class="range-container">
                                    <label>Позиция Y:</label>
                                    <input type="range" id="bottomYPosition" min="300" max="590" value="550">
                                    <span id="bottomYValue">550</span>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h4><i class="fas fa-palette"></i> Цвет текста</h4>
                                <div class="color-picker">
                                    <div class="color-option active" style="background-color: white;" data-color="white" title="Белый">
                                        <i class="fas fa-check" style="display: none;"></i>
                                    </div>
                                    <div class="color-option" style="background-color: black;" data-color="black" title="Чёрный"></div>
                                    <div class="color-option" style="background-color: #ff3366;" data-color="#ff3366" title="Розовый"></div>
                                    <div class="color-option" style="background-color: #00d4ff;" data-color="#00d4ff" title="Голубой"></div>
                                    <div class="color-option" style="background-color: #ffcc00;" data-color="#ffcc00" title="Жёлтый"></div>
                                    <div class="color-option tooltip" style="background: linear-gradient(45deg, #ff3366, #00d4ff);" data-color="gradient" title="Градиент">
                                        <i class="fas fa-fill-drip"></i>
                                        <span class="tooltiptext">Градиентный цвет</span>
                                    </div>
                                </div>
                                <div class="range-container">
                                    <label>Обводка:</label>
                                    <input type="color" id="strokeColor" value="#000000" style="width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer;">
                                </div>
                                <div class="range-container">
                                    <label>Толщина:</label>
                                    <input type="range" id="strokeWidth" min="0" max="10" value="2">
                                    <span id="strokeWidthValue">2</span>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h4><i class="fas fa-font"></i> Шрифт</h4>
                                <div class="font-selector">
                                    <div class="font-option active" data-font="Impact" style="font-family: Impact, sans-serif;">Impact</div>
                                    <div class="font-option" data-font="Arial" style="font-family: Arial, sans-serif;">Arial</div>
                                    <div class="font-option" data-font="Comic Sans MS" style="font-family: 'Comic Sans MS', cursive;">Comic Sans</div>
                                    <div class="font-option" data-font="Georgia" style="font-family: Georgia, serif;">Georgia</div>
                                    <div class="font-option" data-font="Courier New" style="font-family: 'Courier New', monospace;">Courier</div>
                                    <div class="font-option" data-font="Verdana" style="font-family: Verdana, sans-serif;">Verdana</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Effects Panel -->
                        <div class="editor-panel" id="effectsPanel">
                            <div class="control-group">
                                <h4><i class="fas fa-sliders-h"></i> Фильтры</h4>
                                <div class="advanced-controls">
                                    <button class="feature-btn" data-filter="none">
                                        <i class="fas fa-times"></i>
                                        Без фильтра
                                    </button>
                                    <button class="feature-btn" data-filter="grayscale(100%)">
                                        <i class="fas fa-moon"></i>
                                        Ч/Б
                                    </button>
                                    <button class="feature-btn" data-filter="sepia(100%)">
                                        <i class="fas fa-vintage"></i>
                                        Сепия
                                    </button>
                                    <button class="feature-btn" data-filter="invert(100%)">
                                        <i class="fas fa-ghost"></i>
                                        Инвертировать
                                    </button>
                                    <button class="feature-btn" data-filter="brightness(150%)">
                                        <i class="fas fa-sun"></i>
                                        Ярче
                                    </button>
                                    <button class="feature-btn" data-filter="contrast(200%)">
                                        <i class="fas fa-adjust"></i>
                                        Контраст
                                    </button>
                                    <button class="feature-btn" data-filter="hue-rotate(90deg)">
                                        <i class="fas fa-palette"></i>
                                        Цвет
                                    </button>
                                    <button class="feature-btn" data-filter="blur(5px)">
                                        <i class="fas fa-cloud"></i>
                                        Размытие
                                    </button>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h4><i class="fas fa-crop-alt"></i> Обрезка и поворот</h4>
                                <div class="advanced-controls">
                                    <button class="feature-btn" id="cropSquare">
                                        <i class="fas fa-square"></i>
                                        Квадрат
                                    </button>
                                    <button class="feature-btn" id="cropInstagram">
                                        <i class="fab fa-instagram"></i>
                                        Instagram
                                    </button>
                                    <button class="feature-btn" id="rotateLeft">
                                        <i class="fas fa-undo"></i>
                                        Повернуть влево
                                    </button>
                                    <button class="feature-btn" id="rotateRight">
                                        <i class="fas fa-redo"></i>
                                        Повернуть вправо
                                    </button>
                                    <button class="feature-btn" id="flipHorizontal">
                                        <i class="fas fa-arrows-alt-h"></i>
                                        Отразить
                                    </button>
                                    <button class="feature-btn" id="resetTransform">
                                        <i class="fas fa-sync-alt"></i>
                                        Сбросить
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Stickers Panel -->
                        <div class="editor-panel" id="stickersPanel">
                            <div class="control-group">
                                <h4><i class="fas fa-sticky-note"></i> Стикеры и эмодзи</h4>
                                <div class="stickers-panel" id="stickersContainer">
                                    <!-- Stickers will be loaded here -->
                                </div>
                                <div class="editor-buttons" style="margin-top: 15px;">
                                    <button class="editor-btn secondary-btn" id="addEmojiBtn">
                                        <i class="fas fa-smile"></i> Эмодзи
                                    </button>
                                    <button class="editor-btn secondary-btn" id="uploadStickerBtn">
                                        <i class="fas fa-upload"></i> Загрузить
                                    </button>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h4><i class="fas fa-image"></i> Рамки</h4>
                                <div class="advanced-controls">
                                    <button class="feature-btn" data-frame="none">
                                        Без рамки
                                    </button>
                                    <button class="feature-btn" data-frame="solid">
                                        Простая
                                    </button>
                                    <button class="feature-btn" data-frame="polaroid">
                                        Полароид
                                    </button>
                                    <button class="feature-btn" data-frame="instagram">
                                        Instagram
                                    </button>
                                    <button class="feature-btn" data-frame="rounded">
                                        Закругленная
                                    </button>
                                    <button class="feature-btn" data-frame="shadow">
                                        С тенью
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Branding Panel -->
                        <div class="editor-panel" id="brandingPanel">
                            <div class="control-group branding-settings">
                                <h4><i class="fas fa-crown"></i> Кастомизация бренда</h4>
                                <p style="color: var(--gray); font-size: 14px; margin-bottom: 15px;">
                                    Настройте логотип и цвета сайта под ваш бренд
                                </p>
                                
                                <div class="range-container" style="margin-bottom: 15px;">
                                    <label>Загрузить логотип:</label>
                                    <input type="file" id="brandLogoUpload" accept="image/*" style="display: none;">
                                    <button class="editor-btn secondary-btn" id="uploadBrandLogoBtn" style="padding: 8px 15px;">
                                        <i class="fas fa-upload"></i> Выбрать файл
                                    </button>
                                </div>
                                
                                <div class="range-container" style="margin-bottom: 15px;">
                                    <label>Название бренда:</label>
                                    <input type="text" class="text-input" id="brandName" placeholder="Введите название бренда">
                                </div>
                                
                                <div class="range-container" style="margin-bottom: 15px;">
                                    <label>Цветовая схема:</label>
                                    <div class="brand-color-picker">
                                        <div class="brand-color active" style="background: linear-gradient(135deg, #00d4ff, #ff3366);" data-theme="default"></div>
                                        <div class="brand-color" style="background: linear-gradient(135deg, #ff3366, #ff9966);" data-theme="warm"></div>
                                        <div class="brand-color" style="background: linear-gradient(135deg, #00ff88, #00ccff);" data-theme="cool"></div>
                                        <div class="brand-color" style="background: linear-gradient(135deg, #9966ff, #ff66cc);" data-theme="purple"></div>
                                        <div class="brand-color" style="background: linear-gradient(135deg, #ffcc00, #ff6600);" data-theme="orange"></div>
                                    </div>
                                </div>
                                
                                <button class="editor-btn primary-btn" id="applyBranding" style="margin-top: 10px;">
                                    <i class="fas fa-check"></i> Применить брендинг
                                </button>
                                <button class="editor-btn tertiary-btn" id="resetBranding" style="margin-top: 10px;">
                                    <i class="fas fa-undo"></i> Сбросить
                                </button>
                            </div>
                            
                            <div class="control-group watermark-settings">
                                <h4><i class="fas fa-water"></i> Водяной знак</h4>
                                <div class="range-container">
                                    <label>Текст водяного знака:</label>
                                    <input type="text" class="text-input" id="watermarkText" placeholder="Ваш водяной знак">
                                </div>
                                <div class="range-container">
                                    <label>Прозрачность:</label>
                                    <input type="range" id="watermarkOpacity" min="10" max="100" value="30">
                                    <span id="watermarkOpacityValue">30%</span>
                                </div>
                                <div class="range-container">
                                    <label>Позиция:</label>
                                    <select class="text-input" id="watermarkPosition" style="padding: 8px 15px;">
                                        <option value="bottom-right">Внизу справа</option>
                                        <option value="bottom-left">Внизу слева</option>
                                        <option value="top-right">Вверху справа</option>
                                        <option value="top-left">Вверху слева</option>
                                        <option value="center">По центру</option>
                                    </select>
                                </div>
                                <button class="editor-btn secondary-btn" id="toggleWatermark" style="margin-top: 10px;">
                                    <i class="fas fa-eye"></i> Показать водяной знак
                                </button>
                            </div>
                        </div>
                        
                        <!-- Advanced Panel -->
                        <div class="editor-panel" id="advancedPanel">
                            <div class="control-group">
                                <h4><i class="fas fa-magic"></i> AI-улучшения</h4>
                                <div class="advanced-controls">
                                    <button class="feature-btn" id="aiEnhance">
                                        <i class="fas fa-wand-magic-sparkles"></i>
                                        Улучшить качество
                                    </button>
                                    <button class="feature-btn" id="aiRemoveBg">
                                        <i class="fas fa-eraser"></i>
                                        Удалить фон
                                    </button>
                                    <button class="feature-btn" id="aiColorize">
                                        <i class="fas fa-palette"></i>
                                        Раскрасить
                                    </button>
                                    <button class="feature-btn" id="aiUpscale">
                                        <i class="fas fa-expand-alt"></i>
                                        Увеличить разрешение
                                    </button>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h4><i class="fas fa-share-alt"></i> Экспорт и публикация</h4>
                                <div class="advanced-controls">
                                    <button class="feature-btn" id="exportJpg">
                                        <i class="fas fa-file-image"></i>
                                        JPG
                                    </button>
                                    <button class="feature-btn" id="exportPng">
                                        <i class="fas fa-file-image"></i>
                                        PNG
                                    </button>
                                    <button class="feature-btn" id="exportWebp">
                                        <i class="fas fa-file-image"></i>
                                        WebP
                                    </button>
                                    <button class="feature-btn" id="exportGif">
                                        <i class="fas fa-file-image"></i>
                                        GIF
                                    </button>
                                    <button class="feature-btn" id="shareTwitter">
                                        <i class="fab fa-twitter"></i>
                                        Twitter
                                    </button>
                                    <button class="feature-btn" id="shareInstagram">
                                        <i class="fab fa-instagram"></i>
                                        Instagram
                                    </button>
                                </div>
                            </div>
                            
                            <div class="control-group">
                                <h4><i class="fas fa-history"></i> История изменений</h4>
                                <div class="advanced-controls">
                                    <button class="feature-btn" id="undoBtn">
                                        <i class="fas fa-undo"></i>
                                        Отменить
                                    </button>
                                    <button class="feature-btn" id="redoBtn">
                                        <i class="fas fa-redo"></i>
                                        Повторить
                                    </button>
                                    <button class="feature-btn" id="saveVersion">
                                        <i class="fas fa-save"></i>
                                        Сохранить версию
                                    </button>
                                    <button class="feature-btn" id="loadVersion">
                                        <i class="fas fa-history"></i>
                                        История
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-buttons">
                            <button class="editor-btn primary-btn" id="downloadMeme">
                                <i class="fas fa-download"></i> Скачать мем
                            </button>
                            <button class="editor-btn secondary-btn" id="saveDraft">
                                <i class="fas fa-save"></i> Сохранить проект
                            </button>
                            <button class="editor-btn tertiary-btn" id="resetEditor">
                                <i class="fas fa-redo"></i> Сбросить всё
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Upload Section -->
        <section id="create" style="margin-top: 80px;">
            <div class="section-title">
                <h2>Создать свой мем</h2>
            </div>
            
            <div style="text-align: center; background-color: var(--dark-light); padding: 40px; border-radius: 15px;">
                <h3 style="color: var(--primary); margin-bottom: 20px;">Загрузите своё изображение</h3>
                <p style="color: var(--gray); margin-bottom: 30px; max-width: 600px; margin-left: auto; margin-right: auto;">
                    Загрузите свою картинку и создайте уникальный мем с помощью нашего продвинутого редактора
                </p>
                <div style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-bottom: 30px;">
                    <div style="display: inline-block;">
                        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                        <button class="cta-button" id="uploadButton" style="display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-upload"></i> Загрузить изображение
                        </button>
                    </div>
                    <button class="cta-button" id="cameraButton" style="background: linear-gradient(90deg, var(--secondary), #ff6699); display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-camera"></i> Сделать фото
                    </button>
                    <button class="cta-button" id="urlButton" style="background: linear-gradient(90deg, #00ff88, #00cc66); display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-link"></i> Из URL
                    </button>
                    <button class="cta-button" id="aiGenerateButton" style="background: linear-gradient(90deg, #9966ff, #cc66ff); display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-robot"></i> AI Генерация
                    </button>
                </div>
                <div id="dragDropArea" style="border: 2px dashed var(--primary); border-radius: 15px; padding: 40px; margin-top: 30px; background-color: rgba(0, 212, 255, 0.05);">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--primary); margin-bottom: 15px;"></i>
                    <h4 style="color: var(--primary); margin-bottom: 10px;">Перетащите изображение сюда</h4>
                    <p style="color: var(--gray);">или нажмите на кнопку выше</p>
                </div>
                <div style="margin-top: 30px; color: var(--gray); font-size: 14px;">
                    <p>Поддерживаемые форматы: JPG, PNG, GIF, WebP, SVG (макс. 25 МБ)</p>
                    <p>Рекомендуемый размер: от 800x600 до 4000x4000 пикселей</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <div class="logo-text">MEMS <span>TROJAN</span></div>
                    <p>Самый продвинутый онлайн-инструмент для создания мемов с AI и расширенными функциями редактирования.</p>
                </div>
                
                <div class="footer-links">
                    <h4>Навигация</h4>
                    <ul>
                        <li><a href="#templates">Шаблоны мемов</a></li>
                        <li><a href="#editor">Редактор</a></li>
                        <li><a href="#create">Создать мем</a></li>
                    </ul>
                </div>
                
                <div class="footer-links">
                    <h4>Помощь</h4>
                    <ul>
                        <li><a href="#" id="helpLink">Как создать мем</a></li>
                        <li><a href="#" id="faqLink">Частые вопросы</a></li>
                        <li><a href="#" id="feedbackLink">Обратная связь</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 MEMS TROJAN. Все права защищены. Мемы создаются для развлечения.</p>
            </div>
        </div>
    </footer>

    <!-- Modal для URL изображения -->
    <div class="modal" id="urlModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Загрузить изображение по URL</h3>
                <button class="close-modal" id="closeUrlModal">&times;</button>
            </div>
            <input type="text" class="text-input" id="imageUrl" placeholder="Введите URL изображения...">
            <div class="editor-buttons" style="margin-top: 20px;">
                <button class="editor-btn primary-btn" id="loadUrlImage">Загрузить</button>
                <button class="editor-btn secondary-btn" id="cancelUrlModal">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Modal для эмодзи -->
    <div class="modal" id="emojiModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Выберите эмодзи</h3>
                <button class="close-modal" id="closeEmojiModal">&times;</button>
            </div>
            <div id="emojiContainer" style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; max-height: 300px; overflow-y: auto; padding: 10px;">
                <!-- Эмодзи будут добавлены через JavaScript -->
            </div>
        </div>
    </div>

    <!-- Modal для AI генерации -->
    <div class="modal" id="aiModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">AI Генератор мемов</h3>
                <button class="close-modal" id="closeAiModal">&times;</button>
            </div>
            <div style="margin-bottom: 20px;">
                <p style="color: var(--gray); margin-bottom: 10px;">Опишите мем, который хотите создать:</p>
                <textarea class="text-input" id="aiDescription" placeholder="Например: 'грустный кот сидит за компьютером с надписью когда код не работает'" rows="4"></textarea>
            </div>
            <div style="margin-bottom: 20px;">
                <p style="color: var(--gray); margin-bottom: 10px;">Выберите стиль:</p>
                <div class="advanced-controls">
                    <button class="feature-btn" data-style="funny">Смешной</button>
                    <button class="feature-btn" data-style="sarcastic">Саркастичный</button>
                    <button class="feature-btn" data-style="motivational">Мотивационный</button>
                    <button class="feature-btn" data-style="reaction">Реакция</button>
                </div>
            </div>
            <div class="editor-buttons" style="margin-top: 20px;">
                <button class="editor-btn primary-btn" id="generateAiImage">
                    <i class="fas fa-robot"></i> Сгенерировать
                </button>
                <button class="editor-btn secondary-btn" id="cancelAiModal">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <span id="notificationText"></span>
    </div>

    <script>
        // Расширенный редактор мемов с 25+ шаблонами и кастомизацией брендинга
        document.addEventListener('DOMContentLoaded', function() {
            // ===================== ИНИЦИАЛИЗАЦИЯ ПЕРЕМЕННЫХ =====================
            
            // Основные элементы
            const canvas = document.getElementById('memeCanvas');
            const ctx = canvas.getContext('2d');
            const previewCanvas = document.getElementById('previewCanvas');
            const previewCtx = previewCanvas.getContext('2d');
            const memeEditor = document.getElementById('memeEditor');
            
            // Настройки редактора
            let currentImage = null;
            let currentState = {
                topText: '',
                bottomText: '',
                topFontSize: 40,
                bottomFontSize: 40,
                topY: 50,
                bottomY: 550,
                textColor: 'white',
                strokeColor: '#000000',
                strokeWidth: 2,
                selectedFont: 'Impact',
                filter: 'none',
                rotation: 0,
                scale: 1,
                watermark: {
                    text: '',
                    opacity: 0.3,
                    position: 'bottom-right',
                    visible: false
                },
                stickers: []
            };
            
            let history = [];
            let historyIndex = -1;
            let selectedTemplateCategory = 'all';
            
            // ===================== ИНИЦИАЛИЗАЦИЯ ШАБЛОНОВ =====================
            
            // Массив из 25+ популярных мемов с категориями
            const popularTemplates = [
                // Животные (8)
                // Животные (10)


                
                // Фильмы (6)
                {id: 11, name: "Властелин колец", category: "movies", description: "Легендарная сцена с Голлумом", image: "https://images.unsplash.com/photo-1534447677768-be436bb09401?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 12, name: "Звёздные войны", category: "movies", description: "Йода с мудрым советом", image: "https://images.unsplash.com/photo-1533616688419-b7a585564f70?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 13, name: "Гарри Поттер", category: "movies", description: "Волшебная сцена из фильма", image: "https://images.unsplash.com/photo-1598153346810-860daa814c4b?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 14, name: "Мстители", category: "movies", description: "Командный кадр из фильма", image: "https://images.unsplash.com/photo-1635805737707-575885ab0820?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                
                // Игры (5)
                {id: 15, name: "Майнкрафт: Creeper", category: "games", description: "Знаменитый крипер из игры", image: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 16, name: "Among Us: предатель", category: "games", description: "Среди нас есть предатель", image: "https://images.unsplash.com/photo-1618331833071-1c0c6ee3d19e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 17, name: "Герои Варкрафта", category: "games", description: "Персонажи известной игры", image: "https://images.unsplash.com/photo-1511512578047-dfb367046420?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 18, name: "Киберпанк 2077", category: "games", description: "Футуристический стиль игры", image: "https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 19, name: "Дота 2: момент", category: "games", description: "Культовый момент из игры", image: "https://images.unsplash.com/photo-1542751371-adc38448a05e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                
                // Знаменитости (6)
                {id: 20, name: "Саркастичный Илон", category: "celebrities", description: "Илон Маск с ироничной улыбкой", image: "https://images.unsplash.com/photo-1570295999919-56ceb5ecca61?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 21, name: "Удивлённый Киану", category: "celebrities", description: "Киану Ривз с удивлённым лицом", image: "https://images.unsplash.com/photo-1580477667995-2b94f01c9516?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 22, name: "Смеющаяся Дженнифер", category: "celebrities", description: "Дженнифер Лоуренс смеётся", image: "https://images.unsplash.com/photo-1494790108755-2616c113a1c0?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 23, name: "Задумчивый ДиКаприо", category: "celebrities", description: "Леонардо ДиКаприо размышляет", image: "https://images.unsplash.com/photo-1511367461989-f85a21fda167?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 24, name: "Подмигивающий Райан", category: "celebrities", description: "Райан Гослинг подмигивает", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 25, name: "Серьёзная Скарлетт", category: "celebrities", description: "Скарлетт Йоханссон с серьёзным видом", image: "https://images.unsplash.com/photo-1494790108755-2616c113a1c0?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                
                // Реакции (6)
                {id: 26, name: "Шок и недоверие", category: "reactions", description: "Реакция на неожиданные новости", image: "https://images.unsplash.com/photo-1544725176-7c40e5a71c5e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 27, name: "Лицо ладони", category: "reactions", description: "Когда ситуация безнадёжна", image: "https://images.unsplash.com/photo-1568602471122-7832951cc4c5?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 28, name: "Злой начальник", category: "reactions", description: "Реакция на плохую работу", image: "https://images.unsplash.com/photo-1560250097-0b93528c311a?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 29, name: "Саркастичные аплодисменты", category: "reactions", description: "Аплодисменты с сарказмом", image: "https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 30, name: "Внезапное прозрение", category: "reactions", description: "Момент озарения и понимания", image: "https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 31, name: "Счастливые слезы", category: "reactions", description: "Слёзы радости и счастья", image: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                
                // Дополнительные (6)
                {id: 32, name: "Киберпанк неон", category: "viral", description: "Неоновый стиль киберпанка", image: "https://images.unsplash.com/photo-1518709268805-4e9042af2176?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 33, name: "Аниме реакция", category: "viral", description: "Типичная аниме реакция", image: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 34, name: "Мем с дистрофами", category: "viral", description: "Классический формат дистрофов", image: "https://images.unsplash.com/photo-1543852786-1cf6624b9987?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 35, name: "Шаблон для сравнения", category: "viral", description: "Формат сравнения двух вещей", image: "https://images.unsplash.com/photo-1514888286974-6d03bde4ba14?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 36, name: "Изменение мнения", category: "viral", description: "Шаблон изменения точки зрения", image: "https://images.unsplash.com/photo-1511367461989-f85a21fda167?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"},
                {id: 37, name: "Шаблон выбора", category: "viral", description: "Формат сложного выбора", image: "https://images.unsplash.com/photo-1542751371-adc38448a05e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80"}
            ];
            
            // Стикеры для редактора
            const stickers = [
                '😀', '😂', '🤣', '😍', '🥰', '😎', '🤩', '😜', '🤪', '😏',
                '😒', '😭', '😡', '🤬', '🤯', '🥶', '😱', '🤮', '👻', '💀',
                '👾', '🤖', '🎃', '💩', '🙈', '🙉', '🙊', '👑', '💎', '🔥',
                '✨', '🌟', '💥', '💫', '⭐', '🦄', '🐶', '🐱', '🐭', '🐹',
                '🐰', '🦊', '🐻', '🐼', '🐨', '🐯', '🦁', '🐮', '🐷', '🐸'
            ];
            
            // ===================== ИНИЦИАЛИЗАЦИЯ ЭЛЕМЕНТОВ =====================
            
            // Элементы управления редактором
            const topTextInput = document.getElementById('topText');
            const bottomTextInput = document.getElementById('bottomText');
            const topFontSizeInput = document.getElementById('topFontSize');
            const bottomFontSizeInput = document.getElementById('bottomFontSize');
            const topFontSizeValue = document.getElementById('topFontSizeValue');
            const bottomFontSizeValue = document.getElementById('bottomFontSizeValue');
            const topYPosition = document.getElementById('topYPosition');
            const bottomYPosition = document.getElementById('bottomYPosition');
            const topYValue = document.getElementById('topYValue');
            const bottomYValue = document.getElementById('bottomYValue');
            const colorOptions = document.querySelectorAll('.color-option');
            const fontOptions = document.querySelectorAll('.font-option');
            const strokeColorInput = document.getElementById('strokeColor');
            const strokeWidthInput = document.getElementById('strokeWidth');
            const strokeWidthValue = document.getElementById('strokeWidthValue');
            
            // Элементы брендинга
            const logoIcon = document.getElementById('logoIcon');
            const customLogo = document.getElementById('customLogo');
            const logoText = document.getElementById('logoText');
            const brandLogoUpload = document.getElementById('brandLogoUpload');
            const uploadBrandLogoBtn = document.getElementById('uploadBrandLogoBtn');
            const brandNameInput = document.getElementById('brandName');
            const brandColorPickers = document.querySelectorAll('.brand-color');
            const applyBrandingBtn = document.getElementById('applyBranding');
            const resetBrandingBtn = document.getElementById('resetBranding');
            
            // Элементы водяного знака
            const watermarkText = document.getElementById('watermarkText');
            const watermarkOpacity = document.getElementById('watermarkOpacity');
            const watermarkOpacityValue = document.getElementById('watermarkOpacityValue');
            const watermarkPosition = document.getElementById('watermarkPosition');
            const toggleWatermarkBtn = document.getElementById('toggleWatermark');
            
            // Кнопки
            const downloadBtn = document.getElementById('downloadMeme');
            const resetBtn = document.getElementById('resetEditor');
            const startCreatingBtn = document.getElementById('startCreating');
            const uploadButton = document.getElementById('uploadButton');
            const imageUpload = document.getElementById('imageUpload');
            const saveDraftBtn = document.getElementById('saveDraft');
            
            // Элементы вкладок
            const tabButtons = document.querySelectorAll('.tab-button');
            const categoryButtons = document.querySelectorAll('.category-btn');
            const editorTabs = document.querySelectorAll('.editor-tab');
            const editorPanels = document.querySelectorAll('.editor-panel');
            
            // Другие элементы
            const popularTemplatesContainer = document.getElementById('popularTemplates');
            const stickersContainer = document.getElementById('stickersContainer');
            const canvasLoader = document.getElementById('canvasLoader');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            const dragDropArea = document.getElementById('dragDropArea');
            
            // ===================== ОСНОВНЫЕ ФУНКЦИИ =====================
            
            // Функция для показа уведомлений
            function showNotification(message, type = 'success') {
                notificationText.textContent = message;
                notification.style.backgroundColor = type === 'error' ? 'var(--secondary)' : 'var(--primary)';
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
            
            // Функция сохранения состояния в историю
            function saveState() {
                // Удаляем все состояния после текущего индекса
                history = history.slice(0, historyIndex + 1);
                
                // Сохраняем текущее состояние
                history.push(JSON.parse(JSON.stringify(currentState)));
                historyIndex++;
                
                // Ограничиваем историю 20 шагами
                if (history.length > 20) {
                    history.shift();
                    historyIndex--;
                }
            }
            
            // Функция загрузки изображения
            function loadImage(src) {
                canvasLoader.style.display = 'block';
                
                const img = new Image();
                img.crossOrigin = 'anonymous';
                
                img.onload = function() {
                    currentImage = img;
                    drawMeme();
                    canvasLoader.style.display = 'none';
                    saveState();
                };
                
                img.onerror = function() {
                    canvasLoader.style.display = 'none';
                    showNotification('Ошибка загрузки изображения', 'error');
                };
                
                img.src = src;
            }
            
            // Основная функция отрисовки мема
            function drawMeme() {
                if (!currentImage) return;
                
                // Очищаем canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Сохраняем контекст
                ctx.save();
                
                // Применяем трансформации
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate(currentState.rotation * Math.PI / 180);
                ctx.scale(currentState.scale, currentState.scale);
                ctx.translate(-canvas.width / 2, -canvas.height / 2);
                
                // Применяем фильтр
                ctx.filter = currentState.filter;
                
                // Рассчитываем размеры для отрисовки изображения
                const aspectRatio = currentImage.width / currentImage.height;
                const canvasAspectRatio = canvas.width / canvas.height;
                
                let drawWidth, drawHeight, offsetX, offsetY;
                
                if (aspectRatio > canvasAspectRatio) {
                    drawWidth = canvas.width;
                    drawHeight = canvas.width / aspectRatio;
                    offsetX = 0;
                    offsetY = (canvas.height - drawHeight) / 2;
                } else {
                    drawHeight = canvas.height;
                    drawWidth = canvas.height * aspectRatio;
                    offsetX = (canvas.width - drawWidth) / 2;
                    offsetY = 0;
                }
                
                // Рисуем изображение
                ctx.drawImage(currentImage, offsetX, offsetY, drawWidth, drawHeight);
                
                // Сбрасываем фильтр для текста
                ctx.filter = 'none';
                
                // Настройки текста
                ctx.textAlign = 'center';
                ctx.lineJoin = 'round';
                
                // Верхний текст
                if (currentState.topText) {
                    ctx.font = `bold ${currentState.topFontSize}px ${currentState.selectedFont}`;
                    ctx.textBaseline = 'top';
                    
                    // Применяем цвет текста
                    if (currentState.textColor === 'gradient') {
                        const gradient = ctx.createLinearGradient(0, currentState.topY - 20, canvas.width, currentState.topY + 20);
                        gradient.addColorStop(0, '#ff3366');
                        gradient.addColorStop(1, '#00d4ff');
                        ctx.fillStyle = gradient;
                    } else {
                        ctx.fillStyle = currentState.textColor;
                    }
                    
                    // Добавляем обводку текста
                    if (currentState.strokeWidth > 0) {
                        ctx.strokeStyle = currentState.strokeColor;
                        ctx.lineWidth = currentState.strokeWidth;
                        ctx.strokeText(currentState.topText, canvas.width / 2, currentState.topY);
                    }
                    
                    // Добавляем заливку текста
                    ctx.fillText(currentState.topText, canvas.width / 2, currentState.topY);
                }
                
                // Нижний текст
                if (currentState.bottomText) {
                    ctx.font = `bold ${currentState.bottomFontSize}px ${currentState.selectedFont}`;
                    ctx.textBaseline = 'bottom';
                    
                    // Применяем цвет текста
                    if (currentState.textColor === 'gradient') {
                        const gradient = ctx.createLinearGradient(0, currentState.bottomY - 20, canvas.width, currentState.bottomY + 20);
                        gradient.addColorStop(0, '#ff3366');
                        gradient.addColorStop(1, '#00d4ff');
                        ctx.fillStyle = gradient;
                    } else {
                        ctx.fillStyle = currentState.textColor;
                    }
                    
                    // Добавляем обводку текста
                    if (currentState.strokeWidth > 0) {
                        ctx.strokeStyle = currentState.strokeColor;
                        ctx.lineWidth = currentState.strokeWidth;
                        ctx.strokeText(currentState.bottomText, canvas.width / 2, currentState.bottomY);
                    }
                    
                    // Добавляем заливку текста
                    ctx.fillText(currentState.bottomText, canvas.width / 2, currentState.bottomY);
                }
                
                // Водяной знак
                if (currentState.watermark.visible && currentState.watermark.text) {
                    ctx.font = `20px ${currentState.selectedFont}`;
                    ctx.fillStyle = `rgba(255, 255, 255, ${currentState.watermark.opacity})`;
                    ctx.textBaseline = 'alphabetic';
                    ctx.textAlign = 'right';
                    
                    let watermarkX, watermarkY;
                    
                    switch (currentState.watermark.position) {
                        case 'bottom-right':
                            watermarkX = canvas.width - 20;
                            watermarkY = canvas.height - 20;
                            break;
                        case 'bottom-left':
                            watermarkX = 20;
                            watermarkY = canvas.height - 20;
                            ctx.textAlign = 'left';
                            break;
                        case 'top-right':
                            watermarkX = canvas.width - 20;
                            watermarkY = 40;
                            break;
                        case 'top-left':
                            watermarkX = 20;
                            watermarkY = 40;
                            ctx.textAlign = 'left';
                            break;
                        case 'center':
                            watermarkX = canvas.width / 2;
                            watermarkY = canvas.height / 2;
                            ctx.textAlign = 'center';
                            break;
                    }
                    
                    ctx.fillText(currentState.watermark.text, watermarkX, watermarkY);
                }
                
                // Восстанавливаем контекст
                ctx.restore();
                
                // Обновляем предпросмотр
                updatePreview();
            }
            
            // Обновление предпросмотра
            function updatePreview() {
                const scale = previewCanvas.width / canvas.width;
                previewCtx.clearRect(0, 0, previewCanvas.width, previewCanvas.height);
                previewCtx.drawImage(canvas, 0, 0, previewCanvas.width, previewCanvas.height);
            }
            
            // Инициализация популярных шаблонов
            function initPopularTemplates() {
                popularTemplatesContainer.innerHTML = '';
                
                // Фильтруем шаблоны по категории
                let filteredTemplates = popularTemplates;
                if (selectedTemplateCategory !== 'all') {
                    filteredTemplates = popularTemplates.filter(t => t.category === selectedTemplateCategory);
                }
                
                // Отображаем первые 12 шаблонов (для пагинации)
                const templatesToShow = filteredTemplates.slice(0, 12);
                
                templatesToShow.forEach(template => {
                    const memeCard = document.createElement('div');
                    memeCard.className = 'meme-card';
                    memeCard.innerHTML = `
                        <div class="meme-image">
                            <img src="${template.image}" alt="${template.name}" 
                                 onerror="this.src='https://images.unsplash.com/photo-${getRandomUnsplashId()}?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80'">
                        </div>
                        <div class="meme-info">
                            <h3>${template.name}</h3>
                            <p>${template.description}</p>
                            <button class="use-template" data-id="${template.id}">Использовать шаблон</button>
                        </div>
                    `;
                    popularTemplatesContainer.appendChild(memeCard);
                });
                
                // Инициализируем кнопки использования шаблона
                document.querySelectorAll('.use-template').forEach(button => {
                    button.addEventListener('click', function() {
                        const templateId = parseInt(this.getAttribute('data-id'));
                        const template = popularTemplates.find(t => t.id === templateId);
                        
                        if (template) {
                            loadImage(template.image);
                            memeEditor.classList.add('editor-active');
                            memeEditor.scrollIntoView({ behavior: 'smooth' });
                            showNotification(`Шаблон "${template.name}" загружен`);
                        }
                    });
                });
                
                // Инициализируем пагинацию
                initPagination(filteredTemplates.length);
            }
            
            // Инициализация пагинации
            function initPagination(totalItems) {
                const paginationContainer = document.getElementById('popularPagination');
                paginationContainer.innerHTML = '';
                
                const itemsPerPage = 12;
                const totalPages = Math.ceil(totalItems / itemsPerPage);
                
                for (let i = 1; i <= Math.min(totalPages, 5); i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = i === 1 ? 'page-btn active' : 'page-btn';
                    pageBtn.textContent = i;
                    pageBtn.addEventListener('click', function() {
                        // Здесь можно реализовать загрузку страницы
                        document.querySelectorAll('.page-btn').forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        showNotification(`Загружена страница ${i}`);
                    });
                    paginationContainer.appendChild(pageBtn);
                }
            }
            
            // Инициализация стикеров
            function initStickers() {
                stickersContainer.innerHTML = '';
                
                stickers.forEach((sticker, index) => {
                    const stickerItem = document.createElement('div');
                    stickerItem.className = 'sticker-item';
                    stickerItem.textContent = sticker;
                    stickerItem.style.fontSize = '30px';
                    
                    stickerItem.addEventListener('click', function() {
                        // Добавляем стикер на мем
                        currentState.stickers.push({
                            type: 'emoji',
                            content: sticker,
                            x: canvas.width / 2,
                            y: canvas.height / 2,
                            size: 40
                        });
                        drawMeme();
                        showNotification(`Добавлен стикер ${sticker}`);
                    });
                    
                    stickersContainer.appendChild(stickerItem);
                });
            }
            
            // Служебная функция для случайного изображения
            function getRandomUnsplashId() {
                const unsplashIds = [
                    '1620641788421-7a1c342ea42e',
                    '1611605698335-8b1569810432',
                    '1561948955-570b270e7c36',
                    '1514888286974-6d03bde4ba14',
                    '1543852786-1cf6624b9987',
                    '1573865528899-657a5d2d4c5d'
                ];
                return unsplashIds[Math.floor(Math.random() * unsplashIds.length)];
            }
            
            // ===================== ИНИЦИАЛИЗАЦИЯ СОБЫТИЙ =====================
            
            // Инициализация при загрузке страницы
            function init() {
                // Загружаем первый шаблон
                loadImage(popularTemplates[0].image);
                
                // Инициализируем популярные шаблоны
                initPopularTemplates();
                
                // Инициализируем стикеры
                initStickers();
                
                // Загружаем сохранённый брендинг
                loadBranding();
                
                // Сохраняем начальное состояние
                saveState();
                
                showNotification('Редактор MEMS TROJAN готов к работе!');
            }
            
            // Обработчики событий для текста
            topTextInput.addEventListener('input', function() {
                currentState.topText = this.value;
                drawMeme();
            });
            
            bottomTextInput.addEventListener('input', function() {
                currentState.bottomText = this.value;
                drawMeme();
            });
            
            // Обработчики событий для размера шрифта
            topFontSizeInput.addEventListener('input', function() {
                currentState.topFontSize = parseInt(this.value);
                topFontSizeValue.textContent = currentState.topFontSize;
                drawMeme();
            });
            
            bottomFontSizeInput.addEventListener('input', function() {
                currentState.bottomFontSize = parseInt(this.value);
                bottomFontSizeValue.textContent = currentState.bottomFontSize;
                drawMeme();
            });
            
            // Обработчики событий для позиции Y
            topYPosition.addEventListener('input', function() {
                currentState.topY = parseInt(this.value);
                topYValue.textContent = currentState.topY;
                drawMeme();
            });
            
            bottomYPosition.addEventListener('input', function() {
                currentState.bottomY = parseInt(this.value);
                bottomYValue.textContent = currentState.bottomY;
                drawMeme();
            });
            
            // Обработчики событий для выбора цвета
            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    colorOptions.forEach(opt => {
                        opt.classList.remove('active');
                        const icon = opt.querySelector('i');
                        if (icon) icon.style.display = 'none';
                    });
                    
                    this.classList.add('active');
                    const icon = this.querySelector('i');
                    if (icon) icon.style.display = 'block';
                    
                    currentState.textColor = this.getAttribute('data-color');
                    drawMeme();
                });
            });
            
            // Обработчики событий для выбора шрифта
            fontOptions.forEach(option => {
                option.addEventListener('click', function() {
                    fontOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    currentState.selectedFont = this.getAttribute('data-font');
                    drawMeme();
                });
            });
            
            // Обработчики событий для обводки
            strokeColorInput.addEventListener('input', function() {
                currentState.strokeColor = this.value;
                drawMeme();
            });
            
            strokeWidthInput.addEventListener('input', function() {
                currentState.strokeWidth = parseInt(this.value);
                strokeWidthValue.textContent = currentState.strokeWidth;
                drawMeme();
            });
            
            // Обработчики событий для фильтров
            document.querySelectorAll('[data-filter]').forEach(button => {
                button.addEventListener('click', function() {
                    currentState.filter = this.getAttribute('data-filter');
                    drawMeme();
                    showNotification(`Применён фильтр: ${this.textContent.trim()}`);
                });
            });
            
            // Обработчики событий для трансформаций
            document.getElementById('rotateLeft').addEventListener('click', function() {
                currentState.rotation -= 90;
                drawMeme();
                saveState();
            });
            
            document.getElementById('rotateRight').addEventListener('click', function() {
                currentState.rotation += 90;
                drawMeme();
                saveState();
            });
            
            document.getElementById('flipHorizontal').addEventListener('click', function() {
                currentState.scale *= -1;
                drawMeme();
                saveState();
            });
            
            document.getElementById('resetTransform').addEventListener('click', function() {
                currentState.rotation = 0;
                currentState.scale = 1;
                drawMeme();
                saveState();
            });
            
            // Обработчики событий для водяного знака
            watermarkText.addEventListener('input', function() {
                currentState.watermark.text = this.value;
                if (currentState.watermark.visible) {
                    drawMeme();
                }
            });
            
            watermarkOpacity.addEventListener('input', function() {
                currentState.watermark.opacity = parseInt(this.value) / 100;
                watermarkOpacityValue.textContent = `${this.value}%`;
                if (currentState.watermark.visible) {
                    drawMeme();
                }
            });
            
            watermarkPosition.addEventListener('change', function() {
                currentState.watermark.position = this.value;
                if (currentState.watermark.visible) {
                    drawMeme();
                }
            });
            
            toggleWatermark.addEventListener('click', function() {
                currentState.watermark.visible = !currentState.watermark.visible;
                this.innerHTML = currentState.watermark.visible ? 
                    '<i class="fas fa-eye-slash"></i> Скрыть водяной знак' : 
                    '<i class="fas fa-eye"></i> Показать водяной знак';
                drawMeme();
            });
            
            // ===================== БРЕНДИНГ И ЛОГОТИП =====================
            
            // Загрузка брендинга из localStorage
            function loadBranding() {
                const savedBranding = localStorage.getItem('memsTrojanBranding');
                if (savedBranding) {
                    try {
                        const branding = JSON.parse(savedBranding);
                        
                        // Загружаем логотип
                        if (branding.logo) {
                            customLogo.src = branding.logo;
                            customLogo.style.display = 'block';
                            logoIcon.classList.add('has-custom-logo');
                        }
                        
                        // Загружаем название бренда
                        if (branding.name) {
                            logoText.innerHTML = branding.name + (branding.name.includes('TROJAN') ? '' : ' <span>TROJAN</span>');
                            brandNameInput.value = branding.name.replace(' <span>TROJAN</span>', '');
                        }
                        
                        // Загружаем цветовую схему
                        if (branding.theme) {
                            applyTheme(branding.theme);
                            brandColorPickers.forEach(picker => {
                                picker.classList.toggle('active', picker.getAttribute('data-theme') === branding.theme);
                            });
                        }
                        
                    } catch (e) {
                        console.error('Ошибка загрузки брендинга:', e);
                    }
                }
            }
            
            // Сохранение брендинга в localStorage
            function saveBranding() {
                const branding = {
                    logo: customLogo.src || '',
                    name: brandNameInput.value || 'MEMS',
                    theme: document.querySelector('.brand-color.active').getAttribute('data-theme'),
                    timestamp: Date.now()
                };
                
                localStorage.setItem('memsTrojanBranding', JSON.stringify(branding));
                showNotification('Брендинг успешно сохранён!');
            }
            
            // Применение цветовой темы
            function applyTheme(theme) {
                const root = document.documentElement;
                
                switch (theme) {
                    case 'warm':
                        root.style.setProperty('--primary', '#ff6699');
                        root.style.setProperty('--secondary', '#ff9966');
                        break;
                    case 'cool':
                        root.style.setProperty('--primary', '#00ff88');
                        root.style.setProperty('--secondary', '#00ccff');
                        break;
                    case 'purple':
                        root.style.setProperty('--primary', '#9966ff');
                        root.style.setProperty('--secondary', '#ff66cc');
                        break;
                    case 'orange':
                        root.style.setProperty('--primary', '#ffcc00');
                        root.style.setProperty('--secondary', '#ff6600');
                        break;
                    default:
                        root.style.setProperty('--primary', '#00d4ff');
                        root.style.setProperty('--secondary', '#ff3366');
                }
            }
            
            // Обработчики событий для брендинга
            uploadBrandLogoBtn.addEventListener('click', function() {
                brandLogoUpload.click();
            });
            
            brandLogoUpload.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        customLogo.src = event.target.result;
                        customLogo.style.display = 'block';
                        logoIcon.classList.add('has-custom-logo');
                        showNotification('Логотип успешно загружен');
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            brandColorPickers.forEach(picker => {
                picker.addEventListener('click', function() {
                    brandColorPickers.forEach(p => p.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            applyBrandingBtn.addEventListener('click', function() {
                // Применяем название бренда
                const brandName = brandNameInput.value.trim() || 'MEMS';
                logoText.innerHTML = brandName + ' <span>TROJAN</span>';
                
                // Применяем тему
                const theme = document.querySelector('.brand-color.active').getAttribute('data-theme');
                applyTheme(theme);
                
                // Сохраняем в localStorage
                saveBranding();
            });
            
            resetBrandingBtn.addEventListener('click', function() {
                // Сбрасываем логотип
                customLogo.src = '';
                customLogo.style.display = 'none';
                logoIcon.classList.remove('has-custom-logo');
                
                // Сбрасываем название
                brandNameInput.value = 'MEMS';
                logoText.innerHTML = 'MEMS <span>TROJAN</span>';
                
                // Сбрасываем тему
                brandColorPickers.forEach(picker => {
                    picker.classList.toggle('active', picker.getAttribute('data-theme') === 'default');
                });
                applyTheme('default');
                
                // Удаляем из localStorage
                localStorage.removeItem('memsTrojanBranding');
                showNotification('Брендинг сброшен до стандартного');
            });
            
            // Клик по логотипу для быстрого редактирования
            document.getElementById('logoContainer').addEventListener('click', function() {
                memeEditor.classList.add('editor-active');
                document.querySelector('[data-panel="branding"]').click();
                memeEditor.scrollIntoView({ behavior: 'smooth' });
                showNotification('Переход в настройки брендинга');
            });
            
            // ===================== ОСНОВНЫЕ КНОПКИ =====================
            
            // Сброс редактора
            resetBtn.addEventListener('click', function() {
                if (confirm('Вы уверены, что хотите сбросить всё? Все изменения будут потеряны.')) {
                    currentState = {
                        topText: '',
                        bottomText: '',
                        topFontSize: 40,
                        bottomFontSize: 40,
                        topY: 50,
                        bottomY: 550,
                        textColor: 'white',
                        strokeColor: '#000000',
                        strokeWidth: 2,
                        selectedFont: 'Impact',
                        filter: 'none',
                        rotation: 0,
                        scale: 1,
                        watermark: {
                            text: '',
                            opacity: 0.3,
                            position: 'bottom-right',
                            visible: false
                        },
                        stickers: []
                    };
                    
                    // Сброс значений полей ввода
                    topTextInput.value = '';
                    bottomTextInput.value = '';
                    topFontSizeInput.value = 40;
                    bottomFontSizeInput.value = 40;
                    topYPosition.value = 50;
                    bottomYPosition.value = 550;
                    strokeWidthInput.value = 2;
                    strokeColorInput.value = '#000000';
                    watermarkText.value = '';
                    watermarkOpacity.value = 30;
                    watermarkPosition.value = 'bottom-right';
                    
                    // Сброс визуальных элементов
                    colorOptions.forEach(opt => {
                        opt.classList.remove('active');
                        const icon = opt.querySelector('i');
                        if (icon) icon.style.display = 'none';
                    });
                    document.querySelector('.color-option[data-color="white"]').classList.add('active');
                    document.querySelector('.color-option[data-color="white"] i').style.display = 'block';
                    
                    fontOptions.forEach(opt => opt.classList.remove('active'));
                    document.querySelector('.font-option[data-font="Impact"]').classList.add('active');
                    
                    drawMeme();
                    saveState();
                    showNotification('Редактор полностью сброшен');
                }
            });
            
            // Скачивание мема
            downloadBtn.addEventListener('click', function() {
                const link = document.createElement('a');
                link.download = `mems-trojan-meme-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                showNotification('Мем успешно скачан!');
            });
            
            // Сохранение черновика
            saveDraftBtn.addEventListener('click', function() {
                const projectData = {
                    state: currentState,
                    image: currentImage ? currentImage.src : '',
                    timestamp: Date.now(),
                    template: 'custom'
                };
                
                localStorage.setItem('memsTrojanProject', JSON.stringify(projectData));
                showNotification('Проект сохранён в черновик');
            });
            
            // Кнопка "Начать создавать"
            startCreatingBtn.addEventListener('click', function() {
                memeEditor.classList.add('editor-active');
                memeEditor.scrollIntoView({ behavior: 'smooth' });
            });
            
            // Загрузка изображения
            uploadButton.addEventListener('click', function() {
                imageUpload.click();
            });
            
            imageUpload.addEventListener('change', function(e) {
                if (e.target.files && e.target.files[0]) {
                    if (e.target.files[0].size > 25 * 1024 * 1024) {
                        showNotification('Файл слишком большой (макс. 25 МБ)', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        loadImage(event.target.result);
                        memeEditor.classList.add('editor-active');
                        memeEditor.scrollIntoView({ behavior: 'smooth' });
                        showNotification('Изображение успешно загружено');
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Drag and drop
            dragDropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.backgroundColor = 'rgba(0, 212, 255, 0.1)';
                this.style.borderColor = 'var(--secondary)';
            });
            
            dragDropArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.backgroundColor = 'rgba(0, 212, 255, 0.05)';
                this.style.borderColor = 'var(--primary)';
            });
            
            dragDropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.backgroundColor = 'rgba(0, 212, 255, 0.05)';
                this.style.borderColor = 'var(--primary)';
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    const file = e.dataTransfer.files[0];
                    
                    if (!file.type.match('image.*')) {
                        showNotification('Пожалуйста, загрузите изображение', 'error');
                        return;
                    }
                    
                    if (file.size > 25 * 1024 * 1024) {
                        showNotification('Файл слишком большой (макс. 25 МБ)', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        loadImage(event.target.result);
                        memeEditor.classList.add('editor-active');
                        memeEditor.scrollIntoView({ behavior: 'smooth' });
                        showNotification('Изображение загружено через Drag & Drop');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // ===================== ВКЛАДКИ И НАВИГАЦИЯ =====================
            
            // Переключение вкладок шаблонов
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Активируем вкладку
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Показываем соответствующий контент
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}Tab`).classList.add('active');
                    
                    // Загружаем контент для вкладки
                    if (tabId === 'popular') {
                        initPopularTemplates();
                    }
                });
            });
            
            // Переключение категорий
            categoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    selectedTemplateCategory = category;
                    initPopularTemplates();
                    
                    const categoryNames = {
                        'all': 'Все',
                        'animals': 'Животные',
                        'movies': 'Фильмы',
                        'games': 'Игры',
                        'celebrities': 'Знаменитости',
                        'reactions': 'Реакции'
                    };
                    
                    showNotification(`Показаны шаблоны: ${categoryNames[category]}`);
                });
            });
            
            // Переключение вкладок редактора
            editorTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const panelId = this.getAttribute('data-panel');
                    
                    editorTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    editorPanels.forEach(panel => panel.classList.remove('active'));
                    document.getElementById(`${panelId}Panel`).classList.add('active');
                });
            });
            
            // Плавная прокрутка для навигации
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
            
            // Помощь и обратная связь
            document.getElementById('helpLink').addEventListener('click', function(e) {
                e.preventDefault();
                showNotification('Используйте редактор для добавления текста, стикеров и применения эффектов к изображению!');
            });
            
            document.getElementById('faqLink').addEventListener('click', function(e) {
                e.preventDefault();
                showNotification('Частые вопросы: 1) Сохраняйте проекты кнопкой "Сохранить проект", 2) Кастомизируйте брендинг во вкладке "Брендинг"');
            });
            
            document.getElementById('feedbackLink').addEventListener('click', function(e) {
                e.preventDefault();
                const email = 'feedback@memstrojan.com';
                showNotification(`Отправьте письмо на ${email} или создайте issue на GitHub!`);
            });
            
            // ===================== ЗАПУСК ПРИЛОЖЕНИЯ =====================
            
            init();
        });
    </script>
</body>
</html>
